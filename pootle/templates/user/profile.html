{% extends 'user/base.html'  %}
{% load humanize i18n profile_tags %}

{% block body_id %}profile-page{% endblock %}

{% block header_block %}{% endblock %}
{% block breadcrumbs_block %}{% endblock %}

{% block content %}
<div id="user-profile" lang="{{ LANGUAGE_CODE }}">

  <div id="user-meta">
    <img src="{{ profile|gravatar:150 }}" width="150" height="150"
    {% if user == profile %} title="{% trans "You can set or change your avatar image at www.gravatar.com" %}"{% endif %} />
    <h1 class="user-name">
      {% if profile.is_anonymous %}
        {% trans 'Anonymous User' %}
      {% else %}
        {{ profile.display_name }}
      {% endif %}
    </h1>
  </div>

{% if not profile.is_meta %}
  <div id="user-stats">
    <h2 class="user-score-title">{% trans 'Score:' %}</h2>
    <h3 class="user-score">
      {% if user == profile and profile.public_score > 0 %}
        <a class="js-popup-tweet" href="https://twitter.com/share?text={% filter urlencode %}{% blocktrans with server_title=settings.TITLE score=profile.public_score|intcomma %}My current score at {{ server_title }} is {{ score }} {% endblocktrans %}{% endfilter %}" title="{% blocktrans %}Tweet this!{% endblocktrans %}">{{ profile.public_score|intcomma }}</a>
      {% else %}
        {{ profile.public_score|intcomma }}
      {% endif %}
    </h3>

    <h3 class="user-position">
    {% with pos=profile.top_language.0 lang=profile.top_language.1 %}
    {% if pos == -1 %}
      {% trans 'No contributions in the last month' %}
    {% else %}
      {% if user == profile %}
        <a class="js-popup-tweet" href="https://twitter.com/share?text={% filter urlencode %}{% blocktrans with server_title=settings.TITLE lang_name=lang.fullname url=lang.get_absolute_url %}I am #{{ pos }} contributor in {{ lang_name }} for this month at {{ server_title }}! {% endblocktrans %}{% endfilter %}" title="{% blocktrans %}Tweet this!{% endblocktrans %}">
          {% blocktrans with lang_name=lang.fullname %}#{{ pos }} contributor in {{ lang_name }} for this month{% endblocktrans %}
        </a>
      {% else %}
        {% blocktrans with lang_name=lang.fullname url=lang.get_absolute_url %}#{{ pos }} contributor in <a href="{{ url }}">{{ lang_name }}</a> for this month{% endblocktrans %}
      {% endif %}
    {% endif %}
    {% endwith %}
    </h3>

    {% with last_event=profile.last_event %}
    {% if last_event %}
    <div class="user-last-activity">
      <div class="label">{% trans 'Latest activity:' %}</div>
      {{ last_event.get_submission_message }}
    </div>
    {% endif %}
    {% endwith %}
  </div>

  {% if profile.bio or profile.has_contact_details or user == profile %}
  <div id="user-details">
    {% if profile.has_contact_details %}
    <ul class="user-contact">
      {% if profile.website %}
      <li><a href="{{ profile.website }}"><i class="icon-user-website"></i>{% trans 'My Website' %}</a></li>
      {% endif %}
      {% if profile.twitter %}
      <li><a href="{{ profile.twitter_url }}"><i class="icon-user-twitter"></i>@{{ profile.twitter }}</a></li>
      {% endif %}
      {% if profile.linkedin %}
      <li><a href="{{ profile.linkedin }}"><i class="icon-user-linkedin"></i>{% trans 'My LinkedIn Profile' %}</a></li>
      {% endif %}
    </ul>
    {% endif %}
    {% if profile.bio %}
    <div class="user-bio">&ldquo;{{ profile.bio }}&rdquo;</div>
    {% endif %}
    {% if user == profile %}
      {% if not profile.has_contact_details or not profile.bio %}
        <div class="user-bio placeholder">{% trans 'Show others who you are, tell about yourself<br/>and make your public profile look gorgeous!' %}</div>
      {% endif %}
      <div class="edit-profile-btn"><a href="{% url 'pootle-profile-personal-edit' %}" class="btn btn-primary">{% trans 'Edit My Public Profile' %}</a></div>
    {% endif %}
  </div>
  {% endif %}
{% else %}
  <div id="user-details" class="meta-user">
    <div class="user-bio placeholder">
    {% if profile.is_anonymous %}
      {% trans 'Some translations are provided by anonymous volunteers. These are registered under this special meta-account.' %}
    {% elif profile.is_system %}
      {% trans 'Some translations are imported from external files. These are registered under this special meta-account.' %}
    {% else %}
      {{ profile.bio }}
    {% endif%}
    </div>
  </div>
{% endif %}

</div>
{% endblock %}

{% block scripts_extra %}
{{ block.super }}
<script type="text/javascript">
$(function() {
  PTL.common.updateRelativeDates();
  setInterval(PTL.common.updateRelativeDates, 6e4);
});
</script>
{% endblock %}
