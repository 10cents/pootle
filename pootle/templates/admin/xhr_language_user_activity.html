<% if (meta.user !== "") { %>
  <h2>Report for <%= meta.user %>, <%= PTL.reports.dateRangeString(meta.start, meta.end) %></h2>
  <% if (total.new.n1 || total.edit.pootle_n1) { %>
    <div id="reports-viewmode">
      <select>
        <option value="new">New translations</option>
        <option value="edit">Edits</option>
      </select>
    </div>
  <% } %>
<% if ((typeof all_projects !== "undefined") && (_.size(all_projects) > 0)) { %>
<% _.each(results, function(lang_data, lang) { %>
<div class="reports-lang<% if (!lang_data.total.new.n1) { %> new-empty<% } %><% if (!lang_data.total.edit.pootle_n1) { %> edit-empty<% } %>">
  <h3><a href="<%= l('/' + lang) %>"><%= lang_data.name %></a></h3>
  <table class="stats">
    <thead>
    <tr>
      <th>Dates</th>
      <th class="project">Total</th>
      <% _.each(all_projects, function (project, i) { %>
        <th class="project"><%= project %></th>
      <% }); %>
    </tr>
    </thead>
    <%= PTL.reports.resetRowStyle()  %>
    <% _.each(lang_data.dates, function (date) { %>
      <tr class="item <%= PTL.reports.cycleEvenOdd() %><% if (date.after_break) { %> date.after_break<% } %>">
        <td><%= PTL.reports.formatDate(date.date) %></td>
        <td class="total number">
          <% if (date.total.new.n1) { %>
            <span class="new" title="Translated words (precise): <%= date.total.new.n1 %>
              Translated words (Pootle): <%= date.total.new.pootle_n1 %>">
                <%= date.total.new.n1 %>
            </span>
          <% } %>
          <% if (date.total.edit.pootle_n1) { %>
            <span class="edit">
              <%= date.total.edit.pootle_n1 %>
            </span>
          <% } %>
        </td>
        <% _.each(all_projects, function (project, code) { %>
          <td class="number">
          <% if (date.projects[code]) { %>
            <% if (date.projects[code].new) { %>
            <span class="new" title="Translated words (precise): <%= date.projects[code].new.n1 %>
              Translated words (Pootle): <%= date.projects[code].new.pootle_n1 %>">
                <%= date.projects[code].new.n1 %>
              </span>
            <% } %>
            <% if (date.projects[code].edit) { %>
              <span class="edit" title="">
                <%= date.projects[code].edit.pootle_n1 %>
              </span>
            <% } %>
          <% } else { %>
            <span title="">&nbsp;</span>
          <% } %>
          </td>
        <% }); %>
      </tr>
    <% });%>

    <tr class="total">
      <td>Total</td>
      <td class="total number">
        <% if (lang_data.total.new.n1) { %>
          <span class="new" title="Translated words (precise): <%= lang_data.total.new.n1 %>
            Translated words (Pootle): <%= lang_data.total.new.pootle_n1 %>">
            <%= lang_data.total.new.n1 %>
          </span>
        <% } %>
        <% if (lang_data.total.edit.pootle_n1) { %>
          <span class="edit">
            <%= lang_data.total.edit.pootle_n1 %>
          </span>
        <% } %>
      </td>
      <% _.each(all_projects, function (project, code) { %>
        <td class="number">
        <% if (lang_data.sums[code]) { %>
          <% if (lang_data.sums[code].new.n1) { %>
            <span class="new" title="Translated words (precise): <%= lang_data.sums[code].new.n1 %>
              Translated words (Pootle): <%= lang_data.sums[code].new.pootle_n1 %>">
              <%= lang_data.sums[code].new.n1 %>
            </span>
          <% } %>
          <% if (lang_data.sums[code].edit.pootle_n1) { %>
            <span class="edit">
              <%= lang_data.sums[code].edit.pootle_n1 %>
            </span>
          <% } %>
        <% } %>
        </td>
      <% }); %>
    </tr>

  </table>
</div>
<% }); %>
<% } else { %>
  <p class="noresults">No activity recorded during this period.</p>
<% } %>
<% } else { %>
  <p class="noresults">Please select a valid user.</p>
<% } %>
