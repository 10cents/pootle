{% extends "translation_projects/base.html" %}
{% load assets baseurl cache cleanhtml i18n locale search translation_project_tags common_tags profile_tags %}
{% load url from future %}
{% get_current_language as LANGUAGE_CODE %}

{% block body_id %}tpoverview{% endblock %}
{% block body_class %}{{ block.super }} js-not-loaded{% endblock %}

{% block breadcrumbs %}
  {{ block.super }}
  {% cache settings.CACHE_TIMEOUT path_trail resource_obj.id %}
    <li class="file-path"><a href="{{ translation_project.pootle_path|l }}">&lt; {% trans "root folder" %} &gt;</a> / {{ resource_obj|trail:"/" }}</li>
  {% endcache %}
{% endblock %}

{% block header_content %}
  <a id="js-path-summary" data-target="js-path-summary-more" href="{{ url_path_summary_more }}">
    <i id="js-expand-icon" class="icon-expand-stats" title="{% trans "Expand details" %}"></i>
    <div id="progressbar">{% include "core/progressbar.html" %}</div>
    <!--<div class="label js-label"></div>-->
  </a>

  <div class="path-summary-more" id="js-path-summary-more" data-loaded="false" data-collapsed="true">
    <div class="hd">
      <h3><span>{% trans "Translation Statistics" %}</span></h3>
    </div>
    <div class="bd">
      <table class="stats" lang="{{ LANGUAGE_CODE }}" dir="{% locale_dir %}">
        <tbody>
          {% for item in translation_states %}
          <tr id="stats-{{ item.state }}">
            <td id="stats-name">{{ item.title }}</td>
            <td class="stats-number"><a href="{{ item.url }}"></a></td>
            <td class="stats-percentage"><span></span>%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="hd">
      <h3><span>{% trans "Failing Checks" %}</span></h3>
    </div>
    <div class="bd">
    {% for item in check_categories %}
      <div id="check-{{ item.code }}" class="checks js-checks">
        <h4 class="clear">{{ item.title }}</h4>
        {% for check in item.checks %}
        <div class="check js-check" data-code="{{ check.code }}">
          <div class="check-name"><a href="{{ check.url }}">{{ check.title }}</a></div>
          <div class="check-count"><a href="{{ check.url }}">0</a></div>
        </div>
        {% endfor %}
      </div>
    {% endfor %}
    <div class="clear"></div>
    </div>
  </div>

{% endblock %}

{% block actions %}
  {% render_search %}

  <div id="translate-actions">
    <ul>
      <li id="action-continue" class="js-action">
        <a class="continue-translation" href="{{ url_action_continue }}">
          <span class="caption">{% trans 'Continue translation' %}</span>
          <span class="counter">0</span>
        </a>
      </li>
      <li id="action-review">
        <a class="review-suggestions" href="{{ url_action_review }}">
          <span class="caption">{% trans 'Review suggestions' %}</span>
          <span class="counter">0</span>
        </a>
      </li>
      <li id="action-fix-critical">
        <a class="fix-errors" href="{{ url_action_fixcritical }}">
          <span class="caption">{% trans 'Fix ctitical errors' %}</span>
          <span class="counter">0</span>
        </a>
      </li>
      <li id="action-view-all">
        <a class="translation-complete" href="{{ url_action_view_all }}">
          <span class="caption">{% trans 'View all' %}</span>
          <span class="counter">0</span>
        </a>
      </li>
    </ul>
  </div>
{% endblock %}

{% block content %}

{% if table %}
<div class="bd">
  <div class="files-subfolders" lang="{{ LANGUAGE_CODE }}">
    {% display_table table %}
  </div>
</div>
{% endif %}

{% endblock content %}

{% block scripts_extra %}
{{ block.super }}
<script type="text/javascript">
$(function() {
  $("body").spin();
  PTL.search.init();
  PTL.stats.init({
      url: "{{ url_path_stats }}",
      check_url: "{{ url_path_checks }}"
  });
  PTL.stats.load(function() {
    $("body").spin(false);
  });
});
</script>
{% if user.is_superuser or request.permissions.administrate %}
{% assets "js_admin" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
{% endif %}
{% endblock %}
